create or replace package body PCK_ALC_SUBACTIVIDADXGRUPO is

PROCEDURE PRC_BUSCA_SUBACTIVIDAD(
   --Campos Identificador registro
   PAR_COAXAR           ALC_ARXACXSUBACT.N_COAXAR%TYPE,
   PAR_OUT_CURSOR OUT SYS_REFCURSOR
)
IS
v_query VARCHAR2(300);

 BEGIN 
    v_query :=  'SELECT N_CDCATL, C_DDCATL , C_VALCAT , N_CSUBXA  FROM ALC_ARXACXSUBACT A1 INNER JOIN ALC_DETCATLG A2 ON A1.N_CODSUB = A2.N_CDCATL WHERE A1.N_ESTSXG=1 AND A1.N_COAXAR = '||PAR_COAXAR;
    OPEN PAR_OUT_CURSOR FOR v_query;
END;

PROCEDURE PRC_GET_SUBACTIVIDADXGRUPO(
   --Campos Identificador registro
   PAR_COAXAR                  ALC_ARXACXSUBACT.N_COAXAR%TYPE,
   PAR_CODSUB                  ALC_ARXACXSUBACT.N_CODSUB%TYPE,
   PAR_OUT_CURSOR OUT SYS_REFCURSOR
)
IS
v_query VARCHAR2(300);
v_where VARCHAR2(300);

 BEGIN 
    v_query :=  'SELECT COUNT(*) FROM ALC_ARXACXSUBACT WHERE N_COAXAR='|| PAR_COAXAR;
    v_where := ' AND N_CODSUB= ' || PAR_CODSUB;
    v_query := v_query||v_where;
    OPEN PAR_OUT_CURSOR FOR v_query;

END;

PROCEDURE PRC_INSERT_SUBACTIVIDADXGRUPO(
   PAR_COAXAR           ALC_ARXACXSUBACT.N_COAXAR%TYPE,
   PAR_CODSUB           ALC_ARXACXSUBACT.N_CODSUB%TYPE,
   PAR_ESTSXG           ALC_ARXACXSUBACT.N_ESTSXG%TYPE,
   --Campos de Auditoria

   PAR_USUCRE           ALC_ARXACXSUBACT.A_USUCRE%TYPE,
   PAR_NOMPRG           ALC_ARXACXSUBACT.A_NOMPRG%TYPE
 )
 IS
 BEGIN
 INSERT INTO ALC_ARXACXSUBACT (A_USUCRE,A_USUMOD, A_FECCRE, A_NOMPRG, N_CSUBXA,  N_NRFORM, N_COAXAR , N_CODSUB, N_ESTSXG)
 VALUES (NVL(PAR_USUCRE, ' '),
        NVL(PAR_USUCRE, ' '),
        SYSDATE,
        NVL(PAR_NOMPRG, ' '),
        SQ_ALC_ARXACXSUBACT.NEXTVAL, 
        NVL(PAR_COAXAR, 0),
        NVL(PAR_COAXAR, 0),
        NVL(PAR_CODSUB, 0),
        NVL(PAR_ESTSXG, 0));  
END;

PROCEDURE PRC_UPDATE_SUBACTIVIDADXGRUPO(

      --Campos de Auditoria
   PAR_USUMOD                  ALC_ARXACXSUBACT.A_USUMOD%TYPE,
   PAR_NOMPRG                  ALC_ARXACXSUBACT.A_NOMPRG%TYPE,
     --Campos  actualizar
   PAR_ESTSXG                  ALC_ARXACXSUBACT.N_ESTSXG%TYPE,
       --Campos Identificador registro
   PAR_COAXAR                  ALC_ARXACXSUBACT.N_COAXAR%TYPE,
   PAR_CODSUB                  ALC_ARXACXSUBACT.N_CODSUB%TYPE
)
 IS
 BEGIN

  UPDATE ALC_ARXACXSUBACT
  SET A_USUMOD = NVL(PAR_USUMOD, ' '),
      A_FECMOD = SYSDATE,
      A_NOMPRG = NVL(PAR_NOMPRG, ' '),
      N_ESTSXG = NVL(PAR_ESTSXG, 0)
  WHERE N_COAXAR = PAR_COAXAR AND N_CODSUB = PAR_CODSUB;

END;

end PCK_ALC_SUBACTIVIDADXGRUPO;